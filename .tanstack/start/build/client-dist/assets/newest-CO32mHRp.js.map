{"version":3,"file":"newest-CO32mHRp.js","sources":["../../../../../src/routes/_layout/newest.tsx?tsr-split=component"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\r\nimport { createFileRoute, useSearch } from '@tanstack/react-router';\r\nimport { convexQuery, useConvexPaginatedQuery } from '@convex-dev/react-query';\r\nimport { api } from '../../../convex/_generated/api';\r\nimport { CollectionsDisplay } from '~/components/CollectionsDisplay';\r\nimport { useAuth } from '@clerk/tanstack-react-start';\r\nimport { DEFAULT_COLLECTION_PAGE_SIZE } from '../_layout';\r\n\r\nexport const Route = createFileRoute('/_layout/newest')({\r\n  component: NewestCollections,\r\n  loaderDeps: ({ search }) => {\r\n    return {\r\n      tags: search.tags,\r\n    };\r\n  },\r\n  loader: async ({ context, deps }) => {\r\n    context.queryClient.ensureQueryData({\r\n      ...convexQuery(api.collections.listCollections, {\r\n        tags: deps.tags && deps.tags.length > 0 ? deps.tags : undefined,\r\n        sort: 'new',\r\n        paginationOpts: {\r\n          numItems: DEFAULT_COLLECTION_PAGE_SIZE,\r\n          cursor: null,\r\n        },\r\n      }),\r\n      gcTime: 4000,\r\n    });\r\n  },\r\n});\r\n\r\nfunction NewestCollections() {\r\n  const { userId } = useAuth();\r\n  const search = useSearch({\r\n    from: '/_layout',\r\n  });\r\n  const {\r\n    results: collections,\r\n    isLoading,\r\n    loadMore,\r\n    status,\r\n  } = useConvexPaginatedQuery(\r\n    api.collections.listCollections,\r\n    {\r\n      tags: search.tags && search.tags.length > 0 ? search.tags : undefined,\r\n      sort: 'new',\r\n    },\r\n    { initialNumItems: DEFAULT_COLLECTION_PAGE_SIZE }, // or whatever page size you want\r\n  );\r\n\r\n  const { data: likedSeeds, isPending: likesPending } = useQuery({\r\n    ...convexQuery(api.likes.checkUserLikedSeeds, {\r\n      userId,\r\n      seeds: collections.map((c) => c.seed),\r\n    }),\r\n    gcTime: Number.POSITIVE_INFINITY,\r\n    enabled: Boolean(userId) && collections.length > 0 && status !== 'LoadingMore',\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <CollectionsDisplay\r\n        collections={collections}\r\n        likedSeeds={likedSeeds}\r\n        likesPending={likesPending}\r\n        isLoading={isLoading}\r\n      />\r\n\r\n      {status === 'CanLoadMore' && collections.length < 120 && (\r\n        <div className=\"flex justify-center mt-24\">\r\n          <button\r\n            onClick={() => loadMore(DEFAULT_COLLECTION_PAGE_SIZE)}\r\n            className=\"disable-animation-on-theme-change cursor-pointer font-poppins transition-all duration-200 \r\n                    px-5 py-1.5 rounded-sm border select-none z-10 whitespace-nowrap inline-flex justify-center \r\n                    items-center h-10 lowercase gap-1.5 text-sm\r\n                    bg-background/20 text-muted-foreground hover:text-foreground hover:border-muted-foreground/50 \r\n                    border-border font-normal backdrop-blur-sm\"\r\n            aria-label=\"Load more gradients\"\r\n          >\r\n            load more\r\n          </button>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":["SplitComponent","$","_c","userId","useAuth","t0","Symbol","for","from","search","useSearch","tags","length","undefined","t2","t1","sort","t3","initialNumItems","DEFAULT_COLLECTION_PAGE_SIZE","results","collections","isLoading","loadMore","status","useConvexPaginatedQuery","t4","convexQuery","map","_temp","Boolean","t6","t5","gcTime","Number","POSITIVE_INFINITY","enabled","data","likedSeeds","isPending","likesPending","useQuery","t7","jsx","CollectionsDisplay","t8","t9","c","seed"],"mappings":"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"}