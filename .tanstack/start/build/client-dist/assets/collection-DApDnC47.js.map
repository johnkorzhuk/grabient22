{"version":3,"file":"collection-DApDnC47.js","sources":["../../../../../src/routes/_layout/collection.tsx?tsr-split=component"],"sourcesContent":["import { createFileRoute } from '@tanstack/react-router';\r\nimport { CollectionsDisplay } from '~/components/CollectionsDisplay';\r\nimport { deserializeCoeffs } from '~/lib/serialization';\r\nimport { DEFAULT_ANGLE, DEFAULT_STEPS, DEFAULT_STYLE } from '~/validators';\r\nimport type { AppCollection } from '~/types';\r\n\r\nimport { useAuth } from '@clerk/tanstack-react-start';\r\nimport { api } from '../../../convex/_generated/api';\r\nimport type { Id } from '../../../convex/_generated/dataModel';\r\nimport { convexQuery } from '@convex-dev/react-query';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { useConvexPaginatedQuery } from '@convex-dev/react-query';\r\nimport { DEFAULT_COLLECTION_PAGE_SIZE } from '../_layout';\r\n\r\n// Define the route\r\nexport const Route = createFileRoute('/_layout/collection')({\r\n  component: CollectionRoute,\r\n});\r\n\r\nfunction CollectionRoute() {\r\n  const { userId } = useAuth();\r\n\r\n  // Use Convex's usePaginatedQuery hook with a small initial count\r\n  const {\r\n    results: likedSeeds,\r\n    status,\r\n    loadMore,\r\n    isLoading: collectionsLoading,\r\n  } = useConvexPaginatedQuery(\r\n    api.likes.getAllLikedSeedsByUser,\r\n    userId ? { userId } : 'skip',\r\n    { initialNumItems: DEFAULT_COLLECTION_PAGE_SIZE }, // Start with just 10 items\r\n  );\r\n\r\n  // Process collections directly in the render function\r\n  const isLoading = status === 'LoadingFirstPage';\r\n\r\n  // Process the collections from likedSeeds\r\n  const collections = likedSeeds\r\n    ? (likedSeeds\r\n        .map((like) => {\r\n          try {\r\n            // Deserialize the seed to get coeffs and globals\r\n            const { coeffs, globals } = deserializeCoeffs(like.seed);\r\n\r\n            // Create an AppCollection object\r\n            const collection: AppCollection = {\r\n              coeffs,\r\n              globals,\r\n              style: like.style || DEFAULT_STYLE,\r\n              steps: like.steps || DEFAULT_STEPS,\r\n              angle: like.angle || DEFAULT_ANGLE,\r\n              _id: like._id as unknown as Id<'collections'>,\r\n              seed: like.seed,\r\n              likes: 0,\r\n              _creationTime: like._creationTime,\r\n            };\r\n\r\n            return collection;\r\n          } catch (error) {\r\n            console.error('Error deserializing seed:', error);\r\n            return null;\r\n          }\r\n        })\r\n        .filter(Boolean) as AppCollection[])\r\n    : [];\r\n\r\n  const { data, isPending: likesPending } = useQuery({\r\n    ...convexQuery(api.likes.checkUserLikedSeeds, {\r\n      userId,\r\n      seeds: collections.map((c) => c.seed),\r\n    }),\r\n    gcTime: Number.POSITIVE_INFINITY,\r\n    enabled: Boolean(userId),\r\n  });\r\n\r\n  // Manual function to load more\r\n  // const handleLoadMore = () => {\r\n  //   if (status === 'CanLoadMore') {\r\n  //     loadMore(PAGE_SIZE);\r\n  //   }\r\n  // };\r\n\r\n  // if (isLoading || status === 'LoadingFirstPage') {\r\n  //   return (\r\n  //     <div className=\"flex h-full items-center justify-center\">\r\n  //       <div className=\"text-center\">\r\n  //         <div className=\"spinner mb-4\"></div>\r\n  //         <p>Loading your liked collections...</p>\r\n  //       </div>\r\n  //     </div>\r\n  //   );\r\n  // }\r\n\r\n  // if (collections.length === 0) {\r\n  //   return (\r\n  //     <div className=\"flex flex-col h-full items-center justify-center\">\r\n  //       <h2 className=\"text-xl font-semibold mb-2\">No Liked Collections</h2>\r\n  //       <p className=\"text-gray-500\">You haven't liked any collections yet.</p>\r\n  //     </div>\r\n  //   );\r\n  // }\r\n\r\n  return (\r\n    <>\r\n      <CollectionsDisplay\r\n        collections={collections}\r\n        likedSeeds={data}\r\n        likesPending={likesPending}\r\n        isLoading={collectionsLoading || isLoading}\r\n      />\r\n\r\n      {status === 'CanLoadMore' && collections.length < 120 && (\r\n        <div className=\"flex justify-center mt-24\">\r\n          <button\r\n            onClick={() => loadMore(DEFAULT_COLLECTION_PAGE_SIZE)}\r\n            className=\"disable-animation-on-theme-change cursor-pointer font-poppins transition-all duration-200 \r\n                          px-5 py-1.5 rounded-sm border select-none z-10 whitespace-nowrap inline-flex justify-center \r\n                          items-center h-10 lowercase gap-1.5 text-sm\r\n                          bg-background/20 text-muted-foreground hover:text-foreground hover:border-muted-foreground/50 \r\n                          border-border font-normal backdrop-blur-sm\"\r\n            aria-label=\"Load more gradients\"\r\n          >\r\n            load more\r\n          </button>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":["SplitComponent","userId","useAuth","results","likedSeeds","status","loadMore","isLoading","collectionsLoading","useConvexPaginatedQuery","api","likes","getAllLikedSeedsByUser","initialNumItems","DEFAULT_COLLECTION_PAGE_SIZE","collections","map","like","coeffs","globals","deserializeCoeffs","seed","collection","style","DEFAULT_STYLE","steps","DEFAULT_STEPS","angle","DEFAULT_ANGLE","_id","_creationTime","error","filter","Boolean","data","isPending","likesPending","useQuery","convexQuery","checkUserLikedSeeds","seeds","c","gcTime","Number","POSITIVE_INFINITY","enabled","jsxs","Fragment","jsx","CollectionsDisplay","length"],"mappings":"qlBAcAA,MAAAA,EAAA,UAK2B,CACnB,KAAA,CAAEC,OAAAA,GAAWC,EAAQ,EAGrB,CACJC,QAASC,EACTC,OAAAA,EACAC,SAAAA,EACAC,UAAWC,CAAAA,EACTC,EACFC,EAAIC,MAAMC,uBACVX,EAAS,CAAEA,OAAAA,CAAAA,EAAW,OACtB,CAAEY,gBAAiBC,CAAAA,CACrB,EAGMP,EAAYF,IAAW,mBAGvBU,EAAcX,EACfA,EACEY,IAAcC,GAAA,CACT,GAAA,CAEI,KAAA,CAAEC,OAAAA,EAAQC,QAAAA,CAAAA,EAAYC,EAAkBH,EAAKI,IAAI,EAehDC,MAZ2B,CAChCJ,OAAAA,EACAC,QAAAA,EACAI,MAAON,EAAKM,OAASC,EACrBC,MAAOR,EAAKQ,OAASC,EACrBC,MAAOV,EAAKU,OAASC,EACrBC,IAAKZ,EAAKY,IACVR,KAAMJ,EAAKI,KACXV,MAAO,EACPmB,cAAeb,EAAKa,aACtB,QAGOC,EAAO,CACNA,eAAAA,MAAM,4BAA6BA,CAAK,EACzC,IAAA,CACT,CACD,EACAC,OAAOC,OAAO,EACjB,CAAE,EAEA,CAAEC,KAAAA,EAAMC,UAAWC,GAAiBC,EAAS,CACjD,GAAGC,EAAY5B,EAAIC,MAAM4B,oBAAqB,CAC5CtC,OAAAA,EACAuC,MAAOzB,EAAYC,IAAKyB,GAAMA,EAAEpB,IAAI,CAAA,CACrC,EACDqB,OAAQC,OAAOC,kBACfC,QAASZ,EAAQhC,CAAM,CACxB,EA6BD,OAEI6C,EAAA,KAAAC,WAAA,CAAA,SAAA,CAAAC,MAACC,GACC,YAAAlC,EACA,WAAYmB,EACZ,aAAAE,EACA,UAAW5B,GAAsBD,EACjC,EAEDF,IAAW,eAAiBU,EAAYmC,OAAS,KAC/CF,MAAA,MAAA,CAAI,UAAU,4BACb,SAAAA,EAAA,IAAC,UACC,QAAS,IAAM1C,EAASQ,CAA4B,EACpD,UAAU;AAAA;AAAA;AAAA;AAAA,sEAKV,aAAW,sBACZ,SAAA,WAED,CAAA,CACF,CAAA,CAAA,EAEJ,CAEJ"}