import{ag as b,ah as q,r as y,ai as E,aj as T,c as R,o as $,l as A,e as F,u as j,j as o,b as P,d as v,L as U,g as W,h as D,i as J,k as z,Y as H,ac as Z}from"./client-BSueBn7M.js";import{c as S}from"./collection-BIeeWXIH.js";import{d as B}from"./CollectionSeedDisplay-CzsB06tL.js";const Q=()=>Array.from({length:4},()=>0);Q();Q();var G=Object.defineProperty,Y=(r,e,s)=>e in r?G(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,_=(r,e,s)=>Y(r,typeof e!="symbol"?e+"":e,s);class X{constructor(e){_(this,"createWatch"),_(this,"queries"),_(this,"listeners"),this.createWatch=e,this.queries={},this.listeners=new Set}setQueries(e){for(const s of Object.keys(e)){const{query:t,args:n}=e[s];if(b(t),this.queries[s]===void 0)this.addQuery(s,t,n);else{const a=this.queries[s];(b(t)!==b(a.query)||JSON.stringify(q(n))!==JSON.stringify(q(a.args)))&&(this.removeQuery(s),this.addQuery(s,t,n))}}for(const s of Object.keys(this.queries))e[s]===void 0&&this.removeQuery(s)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}getLocalResults(e){const s={};for(const t of Object.keys(e)){const{query:n,args:a}=e[t];b(n);const l=this.createWatch(n,a);let d;try{d=l.localQueryResult()}catch(u){if(u instanceof Error)d=u;else throw u}s[t]=d}return s}setCreateWatch(e){this.createWatch=e;for(const s of Object.keys(this.queries)){const{query:t,args:n,watch:a}=this.queries[s],l=a.journal();this.removeQuery(s),this.addQuery(s,t,n,l)}}destroy(){for(const e of Object.keys(this.queries))this.removeQuery(e);this.listeners=new Set}addQuery(e,s,t,n){if(this.queries[e]!==void 0)throw new Error(`Tried to add a new query with identifier ${e} when it already exists.`);const a=this.createWatch(s,t,n),l=a.onUpdate(()=>this.notifyListeners());this.queries[e]={query:s,args:t,watch:a,unsubscribe:l}}removeQuery(e){const s=this.queries[e];if(s===void 0)throw new Error(`No query found with identifier ${e}.`);s.unsubscribe(),delete this.queries[e]}notifyListeners(){for(const e of this.listeners)e()}}function V({getCurrentValue:r,subscribe:e}){const[s,t]=y.useState(()=>({getCurrentValue:r,subscribe:e,value:r()}));let n=s.value;return(s.getCurrentValue!==r||s.subscribe!==e)&&(n=r(),t({getCurrentValue:r,subscribe:e,value:n})),y.useEffect(()=>{let a=!1;const l=()=>{a||t(u=>{if(u.getCurrentValue!==r||u.subscribe!==e)return u;const h=r();return u.value===h?u:{...u,value:h}})},d=e(l);return l(),()=>{a=!0,d()}},[r,e]),n}function ee(r){const e=E();if(e===void 0)throw new Error("Could not find Convex client! `useQuery` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");const s=y.useMemo(()=>(t,n,a)=>e.watchQuery(t,n,{journal:a}),[e]);return se(r,s)}function se(r,e){const[s]=y.useState(()=>new X(e));s.createWatch!==e&&s.setCreateWatch(e),y.useEffect(()=>()=>s.destroy(),[s]);const t=y.useMemo(()=>({getCurrentValue:()=>s.getLocalResults(r),subscribe:n=>(s.setQueries(r),s.subscribe(n))}),[s,r]);return V(t)}const te=(r,e,s)=>t=>{const n={...t.queries},a=t.nextPageKey,l=t.nextPageKey+1,d=t.nextPageKey+2;n[a]={query:t.query,args:{...t.args,paginationOpts:{...t.queries[r].args.paginationOpts,endCursor:e}}},n[l]={query:t.query,args:{...t.args,paginationOpts:{...t.queries[r].args.paginationOpts,cursor:e,endCursor:s}}};const u={...t.ongoingSplits};return u[r]=[a,l],{...t,nextPageKey:d,queries:n,ongoingSplits:u}},re=r=>e=>{const s=e.ongoingSplits[r];if(s===void 0)return e;const t={...e.queries};delete t[r];const n={...e.ongoingSplits};delete n[r];let a=e.pageKeys.slice();const l=e.pageKeys.findIndex(d=>d===r);return l>=0&&(a=[...e.pageKeys.slice(0,l),...s,...e.pageKeys.slice(l+1)]),{...e,queries:t,pageKeys:a,ongoingSplits:n}};function ce(r,e,s){if(typeof s?.initialNumItems!="number"||s.initialNumItems<0)throw new Error(`\`options.initialNumItems\` must be a positive number. Received \`${s?.initialNumItems}\`.`);const t=e==="skip",n=t?{}:e,a=b(r),l=y.useMemo(()=>()=>{const i=ie();return{query:r,args:n,id:i,nextPageKey:1,pageKeys:t?[]:[0],queries:t?{}:{0:{query:r,args:{...n,paginationOpts:{numItems:s.initialNumItems,cursor:null,id:i}}}},ongoingSplits:{},skip:t}},[JSON.stringify(q(n)),a,s.initialNumItems,t]),[d,u]=y.useState(l);let h=d;(b(r)!==b(d.query)||JSON.stringify(q(n))!==JSON.stringify(q(d.args))||t!==d.skip)&&(h=l(),u(h));const x=E().logger,w=ee(h.queries),[g,p]=y.useMemo(()=>{let i;const m=[];for(const c of h.pageKeys){if(i=w[c],i===void 0)break;if(i instanceof Error){if(i.message.includes("InvalidCursor")||i instanceof T&&typeof i.data=="object"&&i.data?.isConvexSystemError===!0&&i.data?.paginationError==="InvalidCursor")return x.warn("usePaginatedQuery hit error, resetting pagination state: "+i.message),u(l),[[],void 0];throw i}const f=h.ongoingSplits[c];if(f!==void 0?w[f[0]]!==void 0&&w[f[1]]!==void 0&&u(re(c)):i.splitCursor&&(i.pageStatus==="SplitRecommended"||i.pageStatus==="SplitRequired"||i.page.length>s.initialNumItems*2)&&u(te(c,i.splitCursor,i.continueCursor)),i.pageStatus==="SplitRequired")return[m,void 0];m.push(...i.page)}return[m,i]},[w,h.pageKeys,h.ongoingSplits,s.initialNumItems,l,x]),N=y.useMemo(()=>{if(p===void 0)return h.nextPageKey===1?{status:"LoadingFirstPage",isLoading:!0,loadMore:c=>{}}:{status:"LoadingMore",isLoading:!0,loadMore:c=>{}};if(p.isDone)return{status:"Exhausted",isLoading:!1,loadMore:c=>{}};const i=p.continueCursor;let m=!1;return{status:"CanLoadMore",isLoading:!1,loadMore:c=>{m||(m=!0,u(f=>{const O=[...f.pageKeys,f.nextPageKey],I={...f.queries};return I[f.nextPageKey]={query:f.query,args:{...f.args,paginationOpts:{numItems:c,cursor:i,id:f.id}}},{...f,nextPageKey:f.nextPageKey+1,pageKeys:O,queries:I}}))}}},[p,h.nextPageKey]);return{results:g,...N}}let L=0;function ie(){return L++,L}/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],oe=R("SquarePen",ne),de=$(function({collections:e,likedSeeds:s,likesPending:t,isLoading:n=!1}){const{href:a}=A(),{style:l,steps:d,angle:u}=F({from:"/_layout"}),h=j(S.collections),C=y.useRef(!1);y.useEffect(()=>{n||(C.current=!1,S.collections.set(e))},[e,n]);const x=C.current&&h.length>0?h:e,w=(g,p)=>{const N=Z(g,p.globals),i=x.findIndex(c=>String(c._id)===String(p._id)),m=x.find(c=>String(c._id)===String(p._id));if(i!==-1){const c=[...x];c[i]={...x[i],coeffs:g,seed:N,likes:N!==m?.seed?0:m?.likes||0},C.current=!0,S.collections.set(c)}};return o.jsx("section",{className:"h-full w-full relative",children:o.jsxs("ol",{className:P("h-full w-full relative px-5 lg:px-14","grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 3xl:grid-cols-5 4xl:grid-cols-6 gap-x-10 gap-y-20 auto-rows-[300px]"),children:[x.map((g,p)=>{const i=j(v.activeCollectionId)===g._id,m=j(v.previewStyle),c=j(v.previewSteps),f=j(v.previewAngle),O=j(v.previewSeed),I=c!==null?c:d==="auto"?g.steps:d,k=m!==null?m:l==="auto"?g.style:l,M=f!==null||u!=="auto"?f??(typeof u=="number"?parseFloat(u.toFixed(1)):g.angle):g.angle;return o.jsx("li",{className:P("relative group","w-full font-poppins"),onClick:()=>{i?v.activeCollectionId.set(null):v.activeCollectionId.set(g._id)},onMouseLeave:()=>{O&&v.previewSeed.set(null)},tabIndex:0,role:"button","aria-pressed":i,"aria-label":`${i?"Deselect":"Select"} gradient ${p+1} for actions`,children:o.jsx(B,{collection:g,index:p,likedSeeds:s,style:k,steps:I,angle:M,href:a,onChannelOrderChange:w,itemActive:i,likesPending:t,children:o.jsx("div",{className:P("absolute top-3.5 left-3.5 z-10 transition-opacity",{"opacity-0 group-hover:opacity-100":!i,"opacity-100":i}),children:o.jsx(U,{to:"/$seed",params:{seed:g.seed},search:K=>({...K,angle:u==="auto"?g.angle:K.angle,style:l==="auto"?g.style:K.style,steps:d==="auto"?g.steps:K.steps}),className:"block text-foreground/80 hover:text-foreground transition-colors","aria-label":`View details for gradient ${p+1}`,children:o.jsx("div",{className:"bg-background/20 backdrop-blur-sm rounded-md transition-all flex items-center justify-center px-0.5 z-10 h-8 w-9 hover:bg-background/40",children:o.jsx("div",{className:"p-1.5 rounded-full transition-colors cursor-pointer hover:text-foreground",children:o.jsx(W,{children:o.jsxs(D,{children:[o.jsx(J,{asChild:!0,children:o.jsx(oe,{className:"w-5 h-5 text-foreground"})}),o.jsx(z,{children:o.jsx("span",{children:"Edit Palette"})})]})})})})})})})},g._id)}),n&&o.jsx(o.Fragment,{children:Array.from({length:H}).map((g,p)=>o.jsxs("li",{className:"w-full relative",children:[o.jsx("div",{className:"h-[300px] w-full rounded-lg border-2 border-muted animate-pulse"}),o.jsxs("div",{className:"flex justify-between pt-4 relative",children:[o.jsx("div",{className:"flex items-center"}),o.jsx("div",{className:"flex items-center min-h-[28px]",children:o.jsx("div",{className:"relative text-muted-foreground",children:o.jsx("div",{className:"rounded-full cursor-not-allowed opacity-50",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5.5 h-5.5",children:o.jsx("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})})})})})]})]},`placeholder-${p}`))})]})})});export{de as C,ce as u};
